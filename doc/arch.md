
## Architecture -- Lone Gregor

```
                                            ┌──────────────────────────────────────────────┐
                                            │                                              │
                                            ▼                                              │
              ┌──────────────────────────────────────────────────────────┐                 │
              │                             │                    Server  │                 │
              │                             │                            │                 │
              │       ┌─────────────────────┘                            │                 │
              │       │                       ┌───────────────────┐      │                 │
              │       ▼                       │                   │      │
              │  ┌─────────┐  Consume         │    SQL Backend    │      │   Inject new message
              │  │ Message │─────────────────▶│  (StateMachine)   │      │
              │  └─────────┘                  │                   │      │                 │
              │       │                       └───────────────────┘      │                 │
              │       │                                                  │                 │
              │       │(copy)                                            │                 │
              │       │                       ┌───────────────────┐      │                 │
              │       ▼                       │                   │      │                 │
              │  ┌─────────┐  Consume         │    Broadcaster    │      │                 │
              │  │ Message │─────────────────▶│  (StateMachine)   │      │                 │
              │  └─────────┘                  │                   │      │                 │
              │                               └───────────────────┘      │                 │
              │                                         │                │                 │
              └─────────────────────────────────────────┼────────────────┘                 │
                                                        │                                  │
                                                        │                                  │
                                                        │                                  │
          ┌─────────────────────┬──────────────────────┬┴─────────────────────┐            │
          │                     │                      │                      │            │
          │                     │                      │                      │            │
          │Consume              │Consume               │Consume        Consume│            │
          │                     │                      │                      │            │
          ▼                     ▼                      ▼                      ▼            │
┌───────────────────┐ ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐  │
│                   │ │                   │  │                   │  │                   │  │
│   Client Store    │ │   Client Store    │  │   Client Store    │  │   Client Store    │  │
│  (StateMachine)   │ │  (StateMachine)   │  │  (StateMachine)   │  │  (StateMachine)   │──┘
│                   │ │                   │  │                   │  │                   │
└─────────┬─────────┤ └─────────┬─────────┤  └─────────┬─────────┤  └─────────┬─────────┤
          │device 1 │           │device 2 │            │device 3 │            │device 4 │
          └─────────┘           └─────────┘            └─────────┘            └─────────┘
```

## Architecture -- Fleet of Gregors

```
      ┌────────────────────────────────┐                                   ┌───────────────────────────────────┐
      │                                │                                   │                                   │
      │                                ▼                                   │                                   ▼
      │      ┌─────────────────────────┬────────────────────────┐          │              ┌────────────────────┬───────────────────┐
      │      │                         │               Server A │          │              │                    │          Server B │
      │      │       ┌─────────────────┘                        │          │              │                    │                   │
      │      │       │                                          │          │              │                    │                   │
      │      │       │                       ┌────────────────┐ │          │              │                    │                   │
      │      │       ▼                       │                │ │          │              │                    │                   │
      │      │  ┌─────────┐  Consume         │  SQL Backend   │ │          │              │                    │                   │
      │      │  │ Message │─────────────────▶│ (StateMachine) │ │      Broadcast          │                    │                   │
      │      │  └─────────┘                  │                │ │        to all           │                    │                   │
      │      │       │                       └────────────────┘ │     subscribers         │                    │                   │
      │      │       │                                          │          │              │      ┌─────────────┘                   │
      │      │       │(copy)                                    │          │              │      │                                 │
      │      │       │                       ┌───────────────┐  │          │              │      │                                 │
   Inject    │       ▼                       │               │  │          │              │      │                                 │
new message  │  ┌─────────┐  Consume         │   Publisher   │  │          │              │      │                                 │
             │  │ Message │─────────────────▶│(StateMachine) │──┼──────────┘              │      │                                 │
      │      │  └─────────┘                  │               │  │                         │      │                                 │
      │      │       │                       └───────────────┘  │                         │      │                                 │
      │      │       │                                          │                         │      │                                 │
      │      │       │(copy)                                    │                         │      │                                 │
      │      │       │                       ┌───────────────┐  │                         │      │                ┌──────────────┐ │
      │      │       ▼                       │               │  │                         │      ▼                │              │ │
      │      │  ┌─────────┐  Consume         │  Broadcaster  │  │                         │ ┌─────────┐  Consume  │ Broadcaster  │ │
      │      │  │ Message │─────────────────▶│(StateMachine) │  │                         │ │ Message │──────────▶│(StateMachine)│ │
      │      │  └─────────┘                  │               │  │                         │ └─────────┘           │              │ │
      │      │                               └───────┬───────┘  │                         │                       └──────────────┘ │
      │      │                                       │          │                         │                               │        │
      │      └───────────────────────────────────────┼──────────┘                         └───────────────────────────────┼────────┘
      │                                              │                                                                    │
      │                                              │                                                                    │
      │                                              │                                                                    │
      │                                              │                                                                    │
      │            ┌─────────────────────────┬───────┘                                                                    │
      │            │                         │                                                 ┌─────────────────────────┬┘
      │         Consume                    Consume                                             │                         │
      │            │                         │                                              Consume                   Consume
      │            │                         │                                                 │                         │
      │            │                         │                                                 │                         │
      │            │                         │                                                 │                         │
      │            │                         │                                                 │                         │
      │            ▼                         ▼                                                 ▼                         ▼
      │  ┌───────────────────┐     ┌───────────────────┐                             ┌──────────────────┐      ┌──────────────────┐
      │  │                   │     │                   │                             │                  │      │                  │
      │  │   Client Store    │     │   Client Store    │                             │   Client Store   │      │   Client Store   │
      └──│  (StateMachine)   │     │  (StateMachine)   │                             │  (StateMachine)  │      │  (StateMachine)  │
         │                   │     │                   │                             │                  │      │                  │
         └─────────┬─────────┤     └─────────┬─────────┤                             └─────────┬────────┤      └─────────┬────────┤
                   │device 1 │               │device 2 │                                       │device 3│                │device 4│
                   └─────────┘               └─────────┘                                       └────────┘                └────────┘
````
